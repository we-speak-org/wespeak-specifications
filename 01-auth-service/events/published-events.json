{
  "topic": "user.events",
  "description": "Événements liés aux utilisateurs et profils d'apprentissage",
  "partition_key": "userId",
  "retention_ms": 604800000,
  "events": [
    {
      "eventType": "user.profile.created",
      "version": "1.0",
      "description": "Émis lorsqu'un profil utilisateur est créé (synchronisé depuis Keycloak)",
      "schema": {
        "eventType": "string",
        "version": "string",
        "timestamp": "string (ISO 8601)",
        "payload": {
          "userId": "string (MongoDB ObjectId)",
          "keycloakUserId": "string (UUID)",
          "email": "string",
          "displayName": "string",
          "subscriptionTier": "string (enum: free, premium, enterprise)",
          "uiLanguageCode": "string (ISO 639-1)"
        },
        "metadata": {
          "correlationId": "string (UUID)",
          "source": "string (auth-service)"
        }
      },
      "example": {
        "eventType": "user.profile.created",
        "version": "1.0",
        "timestamp": "2025-01-15T10:30:00Z",
        "payload": {
          "userId": "507f1f77bcf86cd799439011",
          "keycloakUserId": "a3b5c7d9-1234-5678-90ab-cdef12345678",
          "email": "john.doe@example.com",
          "displayName": "John Doe",
          "subscriptionTier": "free",
          "uiLanguageCode": "en"
        },
        "metadata": {
          "correlationId": "b2c4d6e8-5678-90ab-cdef-1234567890ab",
          "source": "auth-service"
        }
      },
      "consumers": [
        "gamification-service (consumer-group: gamification)",
        "recommendation-service (consumer-group: recommendation)",
        "notification-service (consumer-group: notification)"
      ]
    },
    {
      "eventType": "learning_profile.created",
      "version": "1.0",
      "description": "Émis lorsqu'un profil d'apprentissage est créé",
      "schema": {
        "eventType": "string",
        "version": "string",
        "timestamp": "string (ISO 8601)",
        "payload": {
          "userId": "string (MongoDB ObjectId)",
          "keycloakUserId": "string (UUID)",
          "profileId": "string (MongoDB ObjectId)",
          "targetLanguageCode": "string (ISO 639-1)",
          "nativeLanguageCode": "string (ISO 639-1)",
          "currentLevel": "string (enum: A1, A2, B1, B2, C1, C2)",
          "goal": "string (enum: work, travel, studies, personal, other)",
          "isPrimary": "boolean"
        },
        "metadata": {
          "correlationId": "string (UUID)",
          "source": "string (auth-service)"
        }
      },
      "example": {
        "eventType": "learning_profile.created",
        "version": "1.0",
        "timestamp": "2025-01-15T10:35:00Z",
        "payload": {
          "userId": "507f1f77bcf86cd799439011",
          "keycloakUserId": "a3b5c7d9-1234-5678-90ab-cdef12345678",
          "profileId": "507f1f77bcf86cd799439022",
          "targetLanguageCode": "en",
          "nativeLanguageCode": "fr",
          "currentLevel": "A1",
          "goal": "work",
          "isPrimary": true
        },
        "metadata": {
          "correlationId": "c3d5e7f9-6789-01ab-cdef-2345678901bc",
          "source": "auth-service"
        }
      },
      "consumers": [
        "lesson-service (débloquer leçons niveau A1)",
        "gamification-service (créer profil gamification)",
        "recommendation-service (initialiser recommandations)",
        "conversation-service (activer matchmaking)"
      ]
    },
    {
      "eventType": "learning_profile.updated",
      "version": "1.0",
      "description": "Émis lorsqu'un profil d'apprentissage est mis à jour",
      "schema": {
        "eventType": "string",
        "version": "string",
        "timestamp": "string (ISO 8601)",
        "payload": {
          "userId": "string (MongoDB ObjectId)",
          "profileId": "string (MongoDB ObjectId)",
          "updatedFields": {
            "currentLevel": "string (optional)",
            "weeklyGoalMinutes": "integer (optional)",
            "isPrimary": "boolean (optional)"
          }
        },
        "metadata": {
          "correlationId": "string (UUID)",
          "source": "string (auth-service)"
        }
      },
      "example": {
        "eventType": "learning_profile.updated",
        "version": "1.0",
        "timestamp": "2025-01-20T14:00:00Z",
        "payload": {
          "userId": "507f1f77bcf86cd799439011",
          "profileId": "507f1f77bcf86cd799439022",
          "updatedFields": {
            "currentLevel": "A2",
            "weeklyGoalMinutes": 200
          }
        },
        "metadata": {
          "correlationId": "d4e6f8g0-7890-12bc-def0-3456789012cd",
          "source": "auth-service"
        }
      },
      "consumers": [
        "lesson-service (débloquer nouvelles leçons)",
        "gamification-service (ajuster objectifs)"
      ]
    },
    {
      "eventType": "credits.consumed",
      "version": "1.0",
      "description": "Émis lorsqu'un crédit est consommé",
      "schema": {
        "eventType": "string",
        "version": "string",
        "timestamp": "string (ISO 8601)",
        "payload": {
          "userId": "string (MongoDB ObjectId)",
          "creditType": "string (enum: conversation, ai_analysis)",
          "amount": "integer",
          "remainingCredits": "integer",
          "resetAt": "string (ISO 8601)"
        },
        "metadata": {
          "correlationId": "string (UUID)",
          "source": "string (auth-service)"
        }
      },
      "example": {
        "eventType": "credits.consumed",
        "version": "1.0",
        "timestamp": "2025-01-16T09:00:00Z",
        "payload": {
          "userId": "507f1f77bcf86cd799439011",
          "creditType": "conversation",
          "amount": 1,
          "remainingCredits": 2,
          "resetAt": "2025-01-22T00:00:00Z"
        },
        "metadata": {
          "correlationId": "e5f7g9h1-8901-23cd-ef01-4567890123de",
          "source": "auth-service"
        }
      },
      "consumers": [
        "analytics-service (tracking usage)",
        "notification-service (alerter si quota proche)"
      ]
    },
    {
      "eventType": "subscription.upgraded",
      "version": "1.0",
      "description": "Émis lorsqu'un utilisateur upgrade vers premium",
      "schema": {
        "eventType": "string",
        "version": "string",
        "timestamp": "string (ISO 8601)",
        "payload": {
          "userId": "string (MongoDB ObjectId)",
          "previousTier": "string (enum: free, premium, enterprise)",
          "newTier": "string (enum: free, premium, enterprise)",
          "expiresAt": "string (ISO 8601)"
        },
        "metadata": {
          "correlationId": "string (UUID)",
          "source": "string (auth-service)"
        }
      },
      "example": {
        "eventType": "subscription.upgraded",
        "version": "1.0",
        "timestamp": "2025-01-18T11:30:00Z",
        "payload": {
          "userId": "507f1f77bcf86cd799439011",
          "previousTier": "free",
          "newTier": "premium",
          "expiresAt": "2025-12-31T23:59:59Z"
        },
        "metadata": {
          "correlationId": "f6g8h0i2-9012-34de-f012-5678901234ef",
          "source": "auth-service"
        }
      },
      "consumers": [
        "gamification-service (débloquer badges premium)",
        "notification-service (email de confirmation)",
        "analytics-service (tracking conversions)"
      ]
    }
  ]
}
